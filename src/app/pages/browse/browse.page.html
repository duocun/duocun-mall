<ion-header>
  <div class="container">
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button></ion-menu-button>
      </ion-buttons>
      <ion-title class="ion-text-center" translate="Home"></ion-title>
      <ion-buttons slot="end">
        <language-button></language-button>
      </ion-buttons>
    </ion-toolbar>
  </div>
</ion-header>

<ion-content>
  <div class="container">
    <ion-searchbar 
    placeholder="{{'Search'|translate}}"
    debounce="1000"
    (ionChange)="handleSearch($event)"
    [value]="search"
  ></ion-searchbar>
  <ng-container *ngIf="viewMode === 'category-only'; Else segmentMode">
    <ion-row class="ion-padding-start ion-padding-end ion-margin-bottom">
      <ion-col size-xs="3" size-lg="2" class="ion-nomargin ion-no-padding">
        <ion-button
          [disabled]="loading"
          color="danger"
          size="small"
          expand="full"
          translate="All"
          (click)="showAll()"
        >
        </ion-button>
      </ion-col>
      <ion-col *ngFor="let category of categories.slice(0,10)" size-xs="3" size-lg="2" class="ion-no-margin ion-no-padding">
        <ion-button
          [disabled]="loading"
          [color]="selectedCategoryId === category._id ? 'success' : 'light'"
          size="small"
          expand="full"
          localValue
          [data]="category"
          key="name"
          (click)="handleSelectCategory(category)"
        >
        </ion-button>
      </ion-col>
      <ion-col *ngIf="categories.length >= 11" size-xs="3" size-lg="2" class="ion-no-margin ion-no-padding">
        <ion-button
          color="tertiary"
          size="small"
          expand="full"
          style="text-align: center; font-weight: 600;"
          localValue
          routerLink="/tabs/browse/all-categories"
        >
          ...
        </ion-button>
      </ion-col>
    </ion-row>
    <ion-row class="ion-padding-start ion-padding-end">
      <ng-container *ngIf="!loading; Else skeleton">
        <ng-container *ngIf="products.length; Else empty">
          <ion-col size-xs="4" size-md="3" size-lg="2" *ngFor="let product of products">
            <ion-card class="ion-no-margin card-product" (click)="onProductClick(product)">
              <ion-card-content>
                <div class="wrapper-product-img">
                  <app-ion-image
                    [src]="getPictureUrl(product)"
                    [alt]="product.name"
                    style="object-fit:cover;"
                  ></app-ion-image>
                </div>
                <div class="label-product-name">
                  <h3 localValue [data]="product" [key]="'name'"></h3>
                  <p>{{product.price | currency:'USD':'symbol' }}</p>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ng-container>
      </ng-container>
    </ion-row>
    <ion-infinite-scroll threshold="96px" (ionInfinite)="loadData($event)" [disabled]="scrollDisabled">
      <ion-infinite-scroll-content
        loadingSpinner="bubbles"
        [loadingText]="'Loading...'|translate">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </ng-container>
  </div>
</ion-content>


<ng-template #empty>
  <ion-col size="12" align="center">
    <ion-label translate="No data to display"></ion-label>
  </ion-col>
</ng-template>

<ng-template #segmentMode>
  <ion-row class="ion-padding">
    <ion-segment [(ngModel)]="viewSegment">
      <ion-segment-button value="merchant">
        <ion-label translate="Merchant"></ion-label>
      </ion-segment-button>
      <ion-segment-button value="category">
        <ion-label translate="Category"></ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-row>
  <merchant-list *ngIf="viewSegment === 'merchant'"></merchant-list>
  <category-list *ngIf="viewSegment === 'category'"></category-list>
</ng-template>

<ng-template #skeleton>
  <ion-col *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]" size="4">
    <ion-card class="ion-no-margin card-product">
      <ion-card-content>
        <div class="wrapper-product-img">
          <app-ion-image
              src="assets/img/no-image.png"
              alt="awesome product"
          ></app-ion-image>
        </div>
        <ion-skeleton-text animated style="height: 0.5rem;"></ion-skeleton-text>
        <ion-skeleton-text animated style="height: 0.5rem;"></ion-skeleton-text>
      </ion-card-content>
    </ion-card>
  </ion-col>
</ng-template>